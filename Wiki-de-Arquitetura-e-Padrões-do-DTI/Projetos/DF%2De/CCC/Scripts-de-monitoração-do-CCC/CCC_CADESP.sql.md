
```
USE CADESP
GO

SELECT '' AS CCC_FILA, count(1) AS NroRegistros FROM [CCC].[FILA]
SELECT TOP 100 '' AS '[CCC].[FILA]', *
  FROM [CCC].[FILA] 
 ORDER BY ID_FILA ASC

SELECT '' AS CCC_FILA_FLUXO_ALTERNATIVO, count(1) AS NroRegistros FROM [CCC].[FILA_FLUXO_ALTERNATIVO]
SELECT TOP 100 '' AS '[CCC].[FILA_FLUXO_ALTERNATIVO]', *
  FROM [CCC].[FILA_FLUXO_ALTERNATIVO] 
 ORDER BY ID_FILA ASC

SELECT '' AS CCC_FILA_LOG, count(1) AS NroRegistros FROM [CCC].[FILA_LOG]
SELECT TOP 1000 '' AS '[CCC].[FILA_LOG]', *
  FROM [CCC].[FILA_LOG]
 ORDER BY ID_FILA_LOG DESC

SELECT '' AS FILA_FLUXO_ALTERNATIVO_LOG, count(1) AS NroRegistros FROM [CCC].[FILA_FLUXO_ALTERNATIVO_LOG]
SELECT TOP 1000 '' AS '[CCC].[FILA_FLUXO_ALTERNATIVO_LOG]', *
  FROM [CCC].[FILA_FLUXO_ALTERNATIVO_LOG]
 ORDER BY pkey DESC

GO 
RETURN

-- Procura de CNPJ específico nos logs

DECLARE @CNPJ    BIGINT = 71659841000153 
DECLARE @NR_CNPJ VARCHAR(14) = (SELECT FORMAT(@CNPJ, 'd14'))

SELECT TOP 10 * 
  FROM      [CADESP].[CCC].[FILA_LOG] fl (nolock)
 INNER JOIN [CADESP].[DBO].[TB_ESTABELECIMENTO] es (nolock)
    ON fl.ID_ESTABELECIMENTO = es.ID_ESTABELECIMENTO
 WHERE es.NR_CNPJ = @NR_CNPJ

 SELECT TOP 10 * 
  FROM      [CADESP].[CCC].[FILA_FLUXO_ALTERNATIVO_LOG] fl (nolock)
 INNER JOIN [CADESP].[DBO].[TB_ESTABELECIMENTO] es (nolock)
    ON fl.ID_ESTABELECIMENTO = es.ID_ESTABELECIMENTO
 WHERE es.NR_CNPJ = @NR_CNPJ

SELECT ID_SITUACAO_ESTABELECIMENTO, ID_OCORRENCIA_CADASTRAL, * 
  FROM [CADESP].[DBO].[TB_ESTABELECIMENTO] (NOLOCK)
 WHERE NR_CNPJ =  @NR_CNPJ

SELECT DT_INICIO_TRANSACAO, ID_SITUACAO_ESTABELECIMENTO, ID_OCORRENCIA_CADASTRAL, * 
  FROM [CADESP].[DBO].[TB_ESTABELECIMENTO_LOG] L (NOLOCK)
 WHERE NR_CNPJ =  @NR_CNPJ
 ORDER BY L.DT_INICIO_TRANSACAO DESC

--============== REPROCESSAMENTO 1 ===================================

SELECT DISTINCT (NR_CNPJ)
  FROM	   [CCC].[FILA_LOG]	          fl (nolock)
INNER JOIN [DBO].[TB_ESTABELECIMENTO] es 
   ON fl.ID_ESTABELECIMENTO = es.ID_ESTABELECIMENTO
 WHERE TX_ERRO NOT LIKE '%não será enviado%'
   AND TX_ERRO NOT LIKE '%Não envia indST=0%'
   AND DT_TIMESTAMP_REG > '2017-03-15'
 ORDER BY NR_CNPJ ASC

--- aí é só colocar no script abaixo os CNPJs
--USE CADESP
--GO

--INSERT INTO CCC.FILA
--(ID_EMPRESA, ID_ESTABELECIMENTO, ID_ENDERECO, ID_PRODUTOR_RURAL)

--SELECT ID_EMPRESA, ID_ESTABELECIMENTO, ID_ENDERECO, ID_PRODUTOR_RURAL 
--FROM TB_ESTABELECIMENTO EST
--WHERE EST.NR_CNPJ IN 
--(
--'00104370000179',
--.........
--'00446858000184)


--============== REPROCESSAMENTO ===================================

SELECT DISTINCT ID_EMPRESA, ID_ESTABELECIMENTO, ID_ENDERECO, ID_PRODUTOR_RURAL, TX_erro--, DT_TIMESTAMP_REG
FROM CCC.FILA_LOG
WHERE ID_ESTABELECIMENTO IS NOT NULL
AND TX_ERRO NOT LIKE 'A network-related%'
AND TX_ERRO NOT LIKE 'Não envia indST=0 e UFEnder!=SP e sem procurador ou CNAE não exceção'
AND TX_ERRO NOT LIKE 'COLUNA: COD_INSCR_MF - Input string was not in a correct format.'
AND DT_TIMESTAMP_REG > '2017-01-01'
--ORDER BY DT_TIMESTAMP_REG DESC

SELECT DISTINCT ID_EMPRESA, ID_ESTABELECIMENTO, ID_ENDERECO, ID_PRODUTOR_RURAL--, DT_TIMESTAMP_REG
INTO #ContribuintesAInserir
FROM CCC.FILA_LOG
WHERE ID_ESTABELECIMENTO IS NOT NULL
AND TX_ERRO NOT LIKE 'A network-related%'
AND TX_ERRO NOT LIKE 'Não envia indST=0 e UFEnder!=SP e sem procurador ou CNAE não exceção'
AND TX_ERRO NOT LIKE 'COLUNA: COD_INSCR_MF - Input string was not in a correct format.'
AND DT_TIMESTAMP_REG > '2017-01-01'
--ORDER BY DT_TIMESTAMP_REG DESC

--SELECT * FROM #ContribuintesAInserir

SELECT 'INSERT INTO CCC.FILA
(ID_EMPRESA, ID_ESTABELECIMENTO, ID_ENDERECO, ID_PRODUTOR_RURAL)
VALUES'

SELECT '(' + CASE WHEN ID_EMPRESA         IS NULL THEN 'NULL' ELSE CONVERT(VARCHAR, ID_EMPRESA)         END  + ',' 
           + CASE WHEN ID_ESTABELECIMENTO IS NULL THEN 'NULL' ELSE CONVERT(VARCHAR, ID_ESTABELECIMENTO) END  + ',' 
           + CASE WHEN ID_ENDERECO        IS NULL THEN 'NULL' ELSE CONVERT(VARCHAR, ID_ENDERECO)        END  + ',' 
           + CASE WHEN ID_PRODUTOR_RURAL  IS NULL THEN 'NULL' ELSE CONVERT(VARCHAR, ID_PRODUTOR_RURAL)  END  + '),' 
FROM #ContribuintesAInserir

--============== REENFILEIRAMENTO MANUAL EM DESENV NO COMEÇO DA FILA ===================================
/*

SELECT TOP 10 ID_EMPRESA, ID_ESTABELECIMENTO, ID_ENDERECO, ID_PRODUTOR_RURAL, * 
  FROM dbo.TB_ESTABELECIMENTO
  WHERE xxxxx

DECLARE @MIN_PKEY_CCC_FILA BIGINT = (SELECT MIN(ID_FILA) FROM [CCC].[FILA]) - 1
SELECT  @MIN_PKEY_CCC_FILA 

SET IDENTITY_INSERT [CCC].[FILA] ON

INSERT INTO CCC.FILA
       (ID_FILA, ID_EMPRESA, ID_ESTABELECIMENTO, ID_ENDERECO, ID_PRODUTOR_RURAL)
VALUES (@MIN_PKEY_CCC_FILA, 153532,	161123,	7088212, NULL)

SET IDENTITY_INSERT [CCC].[FILA] OFF
*/
```
